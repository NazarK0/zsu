"use strict";const e=require("path"),r=require("express"),s=r(),u=require("body-parser"),i=require("./src/Routes/auth_route"),o=require("./src/Routes/user_route"),t=require("mongoose"),n=require("express-handlebars"),a=require("./src/Routes/news_router"),c=require("./src/Routes/sidemenu_router"),d=require("./src/Routes/mainmenu_router"),l=require("./src/Routes/submenu_router"),q=require("./src/Routes/history_route"),m=require("./src/Routes/page_router"),p=require("./src/Routes/content_router"),b=require("./src/Routes/links_route"),g=require("./src/Routes/contact_router"),_=require("./src/Routes/corps_router"),H=require("./src/Routes/command_router"),L=require("./src/Routes/settings_router"),R=require("./src/Routes/public_router"),C=require("./src/API/HandlebarsHelpers/MenuList"),h=require("./src/API/HandlebarsHelpers/SidemenuList"),I=require("./src/API/HandlebarsHelpers/ContentList"),P=require("./src/API/HandlebarsHelpers/LinkCategoriesList"),x=require("./src/API/HandlebarsHelpers/SignCorpsList"),A=require("./src/API/HandlebarsHelpers/BackgroundCorpsList"),k=require("./src/API/HandlebarsHelpers/SignCommandsList"),w=require("./src/API/HandlebarsHelpers/BackgroundCommandsList"),S=require("./src/API/HandlebarsHelpers/ifCond"),v=require("json2xls"),y=require("handlebars-loop"),f=require("express-session"),j=require("cookie-parser"),B=require("connect-mongo")(f),M=require("./settings.json");s.use(u.urlencoded({limit:"50mb",extended:!0})),s.use(u.json({limit:"50mb",extended:!0})),s.use(r.static(e.join(__dirname,"public"))),s.use(u.json()),s.set("trust proxy",1),s.use(j());const T=f({secret:"CMSFORTHESITE",resave:!1,saveUninitialized:!1,store:new B({url:M.db_connect,autoRemove:"diasabled",ttl:21600})});s.use(T),s.use(v.middleware),s.use("/",i),s.use("/admin",i),s.use("/admin/:id_user",[o,a,c,d,l,q,m,b,p,_,g,L,H]),s.use("/",R);const U=n.create({layoutsDir:"views",defaultLayout:"default",extname:"hbs",helpers:{MenuList:C,SidemenuList:h,ContentList:I,LinkCategoriesList:P,SignCorpsList:x,BackgroundCorpsList:A,SignCommandsList:k,BackgroundCommandsList:w,loop:y,ifCond:S}});s.engine("hbs",U.engine),s.set("view engine","hbs"),s.set("views","views"),t.connect(M.db_connect,{useUnifiedTopology:!0,useNewUrlParser:!0},e=>{e&&console.log(e)}).then(()=>{console.log("Db connected!")}).catch(e=>{console.log(e)}),module.exports=s;