"use strict";require("dotenv").config();const e=require("path"),r=require("express"),s=require("express-handlebars"),i=require("mongoose"),t=require("json2xls"),u=require("handlebars-loop"),o=require("morgan"),n=require("node-cron"),a=require("body-parser"),c=require("express-session"),l=require("./src/DefferedPublicationService/index"),d=r(),q=require("./src/Routes/auth_route"),L=require("./src/Routes/user_route"),H=require("./src/Routes/news_router"),p=require("./src/Routes/mainmenu_router"),C=require("./src/Routes/menu_router"),b=require("./src/Routes/submenu_router"),m=require("./src/Routes/history_route"),h=require("./src/Routes/page_router"),k=require("./src/Routes/links_route"),g=require("./src/Routes/contact_router"),_=require("./src/Routes/corps_router"),P=require("./src/Routes/command_router"),I=require("./src/Routes/settings_router"),R=require("./src/Routes/public_router"),A=require("./src/Routes/feedback_router"),v=require("./src/Routes/archive_route"),y=require("./src/Routes/actualContent_router"),f=require("./src/Routes/fetch_router"),w=require("./src/Routes/content-category_router"),x=require("./src/Routes/media_route"),S=require("./src/Routes/video_route"),M=require("./src/API/HandlebarsHelpers/MenuList"),N=require("./src/API/HandlebarsHelpers/SidemenuList"),j=require("./src/API/HandlebarsHelpers/ContentList"),B=require("./src/API/HandlebarsHelpers/LinkCategoriesList"),D=require("./src/API/HandlebarsHelpers/SignCorpsList"),U=require("./src/API/HandlebarsHelpers/BackgroundCorpsList"),T=require("./src/API/HandlebarsHelpers/SignCommandsList"),E=require("./src/API/HandlebarsHelpers/BackgroundCommandsList"),O=require("./src/API/HandlebarsHelpers/CheckListPages"),F=require("./src/API/HandlebarsHelpers/CheckListNews"),W=require("./src/API/HandlebarsHelpers/CheckListCommand"),z=require("./src/API/HandlebarsHelpers/CheckListContacts"),G=require("./src/API/HandlebarsHelpers/CheckListCorps"),J=require("./src/API/HandlebarsHelpers/CheckListLinks"),K=require("./src/API/HandlebarsHelpers/CheckListMenu"),Q=require("./src/API/HandlebarsHelpers/CheckListUsers"),V=require("./src/API/HandlebarsHelpers/CategoriesList"),X=require("./src/API/HandlebarsHelpers/HistoryLabelList"),Y=require("./src/API/HandlebarsHelpers/HistoryWarLabelList"),Z=require("./src/API/HandlebarsHelpers/ifCond"),$=require("./src/API/HandlebarsHelpers/LinkList"),ee=require("cookie-parser"),re=require("connect-mongo")(c),se=require("./settings.json");d.use(a.urlencoded({limit:"50mb",extended:!0})),d.use(a.json({limit:"50mb",extended:!0})),d.use(r.static(e.join(__dirname,"public"))),d.use(a.json()),d.set("trust proxy",1),d.use(ee());const ie=process.env.DB_CONNECTION||se.db_connect,te=c({secret:"CMSFORTHESITE",resave:!1,saveUninitialized:!1,store:new re({url:ie,autoRemove:"diasabled",ttl:21600})});d.use(te),d.use(t.middleware),d.use("/",q),d.use("/admin",q),d.use("/admin/:id_user",[L,H,C,p,b,m,h,k,_,g,I,P,A,v,y,w,x,S]),d.use("/",[R,f]);const ue=s.create({layoutsDir:"views",partialsDir:"views/partials",defaultLayout:"default",extname:"hbs",helpers:{MenuList:M,SidemenuList:N,ContentList:j,LinkCategoriesList:B,SignCorpsList:D,BackgroundCorpsList:U,SignCommandsList:T,BackgroundCommandsList:E,CheckListPages:O,CheckListNews:F,CheckListMenu:K,CheckListCommand:W,CheckListContacts:z,CheckListCorps:G,CheckListLinks:J,CheckListUsers:Q,CategoriesList:V,HistoryLabelList:X,HistoryWarLabelList:Y,loop:u,ifCond:Z,LinkList:$}});d.engine("hbs",ue.engine),d.set("view engine","hbs"),d.set("views"),i.connect(ie,{useUnifiedTopology:!0,useNewUrlParser:!0,useFindAndModify:!1},e=>{e&&console.error(e)}).then(()=>{console.log("Db connected!")}).catch(e=>{console.error(e)}),module.exports=d;