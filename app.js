"use strict";const e=require("path"),r=require("express"),s=r(),u=require("body-parser"),o=require("./src/Routes/auth_route"),i=require("./src/Routes/user_route"),t=require("mongoose"),n=require("express-handlebars"),c=require("./src/Routes/news_router"),a=require("./src/Routes/sidemenu_router"),d=require("./src/Routes/mainmenu_router"),l=require("./src/Routes/submenu_router"),q=require("./src/Routes/history_route"),m=require("./src/Routes/page_router"),p=require("./src/Routes/content_router"),b=require("./src/Routes/links_route"),g=require("./src/Routes/contact_router"),_=require("./src/Routes/corps_router"),H=require("./src/Routes/command_router"),L=require("./src/Routes/settings_router"),R=require("./src/Routes/public_router"),C=require("./src/Routes/feedback_router"),h=require("./src/API/HandlebarsHelpers/MenuList"),I=require("./src/API/HandlebarsHelpers/SidemenuList"),P=require("./src/API/HandlebarsHelpers/ContentList"),k=require("./src/API/HandlebarsHelpers/LinkCategoriesList"),x=require("./src/API/HandlebarsHelpers/SignCorpsList"),A=require("./src/API/HandlebarsHelpers/BackgroundCorpsList"),w=require("./src/API/HandlebarsHelpers/SignCommandsList"),S=require("./src/API/HandlebarsHelpers/BackgroundCommandsList"),v=require("./src/API/HandlebarsHelpers/ifCond"),f=require("json2xls"),y=require("handlebars-loop"),j=require("express-session"),B=require("cookie-parser"),M=require("connect-mongo")(j),T=require("./settings.json");s.use(u.urlencoded({limit:"50mb",extended:!0})),s.use(u.json({limit:"50mb",extended:!0})),s.use(r.static(e.join(__dirname,"public"))),s.use(u.json()),s.set("trust proxy",1),s.use(B());const U=j({secret:"CMSFORTHESITE",resave:!1,saveUninitialized:!1,store:new M({url:T.db_connect,autoRemove:"diasabled",ttl:21600})});s.use(U),s.use(f.middleware),s.use("/",o),s.use("/admin",o),s.use("/admin/:id_user",[i,c,a,d,l,q,m,b,p,_,g,L,H,C]),s.use("/",R);const D=n.create({layoutsDir:"views",defaultLayout:"default",extname:"hbs",helpers:{MenuList:h,SidemenuList:I,ContentList:P,LinkCategoriesList:k,SignCorpsList:x,BackgroundCorpsList:A,SignCommandsList:w,BackgroundCommandsList:S,loop:y,ifCond:v}});s.engine("hbs",D.engine),s.set("view engine","hbs"),s.set("views","views"),t.connect(T.db_connect,{useUnifiedTopology:!0,useNewUrlParser:!0},e=>{e&&console.log(e)}).then(()=>{console.log("Db connected!")}).catch(e=>{console.log(e)}),module.exports=s;