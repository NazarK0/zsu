"use strict";require("dotenv").config();const e=require("path"),r=require("express"),s=require("express-handlebars"),i=require("mongoose"),t=require("json2xls"),u=require("handlebars-loop"),o=require("morgan"),n=require("node-cron"),a=require("body-parser"),c=require("express-session"),l=require("./src/DefferedPublicationService/index"),d=r(),q=require("./src/Routes/auth_route"),p=require("./src/Routes/user_route"),L=require("./src/Routes/news_router"),C=require("./src/Routes/sidemenu_router"),H=require("./src/Routes/mainmenu_router"),b=require("./src/Routes/submenu_router"),m=require("./src/Routes/history_route"),g=require("./src/Routes/page_router"),h=require("./src/Routes/content_router"),k=require("./src/Routes/links_route"),P=require("./src/Routes/contact_router"),_=require("./src/Routes/corps_router"),I=require("./src/Routes/command_router"),A=require("./src/Routes/settings_router"),R=require("./src/Routes/public_router"),w=require("./src/Routes/feedback_router"),v=require("./src/Routes/archive_route"),f=require("./src/Routes/category_router"),x=require("./src/API/HandlebarsHelpers/MenuList"),y=require("./src/API/HandlebarsHelpers/SidemenuList"),S=require("./src/API/HandlebarsHelpers/ContentList"),N=require("./src/API/HandlebarsHelpers/LinkCategoriesList"),M=require("./src/API/HandlebarsHelpers/SignCorpsList"),j=require("./src/API/HandlebarsHelpers/BackgroundCorpsList"),B=require("./src/API/HandlebarsHelpers/SignCommandsList"),D=require("./src/API/HandlebarsHelpers/BackgroundCommandsList"),U=require("./src/API/HandlebarsHelpers/CheckListPages"),T=require("./src/API/HandlebarsHelpers/CheckListNews"),E=require("./src/API/HandlebarsHelpers/CheckListCommand"),O=require("./src/API/HandlebarsHelpers/CheckListContacts"),F=require("./src/API/HandlebarsHelpers/CheckListCorps"),z=require("./src/API/HandlebarsHelpers/CheckListLinks"),G=require("./src/API/HandlebarsHelpers/CheckListMenu"),J=require("./src/API/HandlebarsHelpers/CheckListUsers"),K=require("./src/API/HandlebarsHelpers/NewsCategoriesList"),Q=require("./src/API/HandlebarsHelpers/HistoryLabelList"),V=require("./src/API/HandlebarsHelpers/ifCond"),W=require("cookie-parser"),X=require("connect-mongo")(c),Y=require("./settings.json");d.use(a.urlencoded({limit:"50mb",extended:!0})),d.use(a.json({limit:"50mb",extended:!0})),d.use(r.static(e.join(__dirname,"public"))),d.use(a.json()),d.set("trust proxy",1),d.use(W());const Z=process.env.DB_CONNECTION||Y.db_connect,$=c({secret:"CMSFORTHESITE",resave:!1,saveUninitialized:!1,store:new X({url:Z,autoRemove:"diasabled",ttl:21600})});d.use($),d.use(t.middleware),d.use("/",q),d.use("/admin",q),d.use("/admin/:id_user",[p,L,C,H,b,m,g,k,h,_,P,A,I,w,v,f]),d.use("/",R);const ee=s.create({layoutsDir:"views",partialsDir:"views/partials",defaultLayout:"default",extname:"hbs",helpers:{MenuList:x,SidemenuList:y,ContentList:S,LinkCategoriesList:N,SignCorpsList:M,BackgroundCorpsList:j,SignCommandsList:B,BackgroundCommandsList:D,CheckListPages:U,CheckListNews:T,CheckListMenu:G,CheckListCommand:E,CheckListContacts:O,CheckListCorps:F,CheckListLinks:z,CheckListUsers:J,NewsCategoriesList:K,HistoryLabelList:Q,loop:u,ifCond:V}});d.engine("hbs",ee.engine),d.set("view engine","hbs"),d.set("views"),i.connect(Z,{useUnifiedTopology:!0,useNewUrlParser:!0,useFindAndModify:!1},e=>{e&&console.error(e)}).then(()=>{console.log("Db connected!")}).catch(e=>{console.log(e)}),module.exports=d;