"use strict";const e=require("path"),r=require("express"),s=r(),u=require("body-parser"),t=require("./src/Routes/auth_route"),i=require("./src/Routes/user_route"),o=require("mongoose"),n=require("express-handlebars"),c=require("./src/Routes/news_router"),a=require("./src/Routes/sidemenu_router"),l=require("./src/Routes/mainmenu_router"),d=require("./src/Routes/submenu_router"),q=require("./src/Routes/history_route"),p=require("./src/Routes/page_router"),b=require("./src/Routes/content_router"),m=require("./src/Routes/links_route"),_=require("./src/Routes/contact_router"),g=require("./src/Routes/corps_router"),R=require("./src/Routes/settings_router"),H=require("./src/Routes/public_router"),L=require("./src/API/HandlebarsHelpers/MenuList"),h=require("./src/API/HandlebarsHelpers/SidemenuList"),C=require("./src/API/HandlebarsHelpers/ContentList"),x=require("./src/API/HandlebarsHelpers/LinkCategoriesList"),w=require("./src/API/HandlebarsHelpers/SignCorpsList"),I=require("./src/API/HandlebarsHelpers/BackgroundCorpsList"),P=require("./src/API/HandlebarsHelpers/ifCond"),v=require("json2xls"),A=require("handlebars-loop"),k=require("express-session"),y=require("cookie-parser"),S=require("connect-mongo")(k),f=require("./settings.json");s.use(u.urlencoded({limit:"50mb",extended:!0})),s.use(u.json({limit:"50mb",extended:!0})),s.use(r.static(e.join(__dirname,"public"))),s.use(u.json()),s.set("trust proxy",1),s.use(y());const j=k({secret:"CMSFORTHESITE",resave:!1,saveUninitialized:!1,store:new S({url:f.db_connect,autoRemove:"diasabled",ttl:21600})});s.use(j),s.use(v.middleware),s.use("/",t),s.use("/admin",t),s.use("/admin/:id_user",[i,c,a,l,d,q,p,m,b,g,_,R]),s.use("/",H);const M=n.create({layoutsDir:"views",defaultLayout:"default",extname:"hbs",helpers:{MenuList:L,SidemenuList:h,ContentList:C,LinkCategoriesList:x,SignCorpsList:w,BackgroundCorpsList:I,loop:A,ifCond:P}});s.engine("hbs",M.engine),s.set("view engine","hbs"),s.set("views","views"),o.connect(f.db_connect,{useUnifiedTopology:!0,useNewUrlParser:!0},e=>{e&&console.log(e)}).then(()=>{console.log("Db connected!")}).catch(e=>{console.log(e)}),module.exports=s;