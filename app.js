"use strict";const e=require("path"),r=require("express"),s=r(),u=require("body-parser"),o=require("./src/Routes/auth_route"),i=require("./src/Routes/user_route"),t=require("mongoose"),n=require("express-handlebars"),c=require("./src/Routes/news_router"),a=require("./src/Routes/sidemenu_router"),d=require("./src/Routes/mainmenu_router"),l=require("./src/Routes/submenu_router"),q=require("./src/Routes/history_route"),m=require("./src/Routes/page_router"),p=require("./src/Routes/content_router"),b=require("./src/Routes/links_route"),g=require("./src/Routes/contact_router"),_=require("./src/Routes/corps_router"),H=require("./src/Routes/command_router"),L=require("./src/Routes/settings_router"),R=require("./src/Routes/public_router"),C=require("./src/Routes/feedback_router"),h=require("./src/Routes/archive_route"),I=require("./src/API/HandlebarsHelpers/MenuList"),P=require("./src/API/HandlebarsHelpers/SidemenuList"),k=require("./src/API/HandlebarsHelpers/ContentList"),x=require("./src/API/HandlebarsHelpers/LinkCategoriesList"),A=require("./src/API/HandlebarsHelpers/SignCorpsList"),v=require("./src/API/HandlebarsHelpers/BackgroundCorpsList"),w=require("./src/API/HandlebarsHelpers/SignCommandsList"),S=require("./src/API/HandlebarsHelpers/BackgroundCommandsList"),f=require("./src/API/HandlebarsHelpers/ifCond"),y=require("json2xls"),j=require("handlebars-loop"),B=require("express-session"),M=require("cookie-parser"),T=require("connect-mongo")(B),U=require("./settings.json");s.use(u.urlencoded({limit:"50mb",extended:!0})),s.use(u.json({limit:"50mb",extended:!0})),s.use(r.static(e.join(__dirname,"public"))),s.use(u.json()),s.set("trust proxy",1),s.use(M());const D=B({secret:"CMSFORTHESITE",resave:!1,saveUninitialized:!1,store:new T({url:U.db_connect,autoRemove:"diasabled",ttl:21600})});s.use(D),s.use(y.middleware),s.use("/",o),s.use("/admin",o),s.use("/admin/:id_user",[i,c,a,d,l,q,m,b,p,_,g,L,H,C,h]),s.use("/",R);const E=n.create({layoutsDir:"views",defaultLayout:"default",extname:"hbs",helpers:{MenuList:I,SidemenuList:P,ContentList:k,LinkCategoriesList:x,SignCorpsList:A,BackgroundCorpsList:v,SignCommandsList:w,BackgroundCommandsList:S,loop:j,ifCond:f}});s.engine("hbs",E.engine),s.set("view engine","hbs"),s.set("views","views"),t.connect(U.db_connect,{useUnifiedTopology:!0,useNewUrlParser:!0},e=>{e&&console.log(e)}).then(()=>{console.log("Db connected!")}).catch(e=>{console.log(e)}),module.exports=s;