"use strict";const e=require("moment"),t=require("../Models/History"),i=require("../Models/User"),a=require("../Models/Content"),d=require("../Models/PublishTime"),r=async()=>{const r=e().startOf("minutes").valueOf();let s=await d.find().where({timestamp:r});if(0!==s.length)s.forEach(async e=>{await d.findByIdAndDelete(e._id);let r=await a.findByIdAndUpdate({_id:e.news_id},{$set:{public_status:"active",date:require("moment")().format("YYYY-MM-DDTHH:mm")}}),s=await i.findById({_id:r.user_id});history=new t({type_content:"Новина",operation:"Додавання новини ".concat(r.page_title),user:s.login})});else{(await a.find().where({public_status:"deffered",date:e().format("YYYY-MM-DDTHH:mm")})).forEach(async e=>{await a.findByIdAndUpdate({_id:e._id},{public_status:"active",date:require("moment")().format("YYYY-MM-DDTHH:mm")})})}};module.exports={publishChecker:r};