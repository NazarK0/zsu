"use strict";const e=require("moment"),t=require("../Models/History"),i=require("../Models/User"),a=require("../Models/News"),s=require("../Models/PublishTime"),{updateRss:d}=require("../API/rss"),r=async()=>{const r=e().startOf("minutes").valueOf(),n=await s.find().where({timestamp:r});if(0!==n.length)n.forEach(async d=>{await s.findByIdAndDelete(d._id);const r=await a.findByIdAndUpdate(d.news_id,{$set:{public_status:"active",date:e().toISOString()}}),n=await i.findById({_id:r.user_id});await new t({type_content:"Новина",operation:"Додавання новини ".concat(r.title),user:n.login}).save()});else{(await a.find().where({public_status:"deffered",date:e().toISOString()})).forEach(async t=>{await a.findByIdAndUpdate(t._id,{public_status:"active",date:e().toISOString()})})}await d()};module.exports={publishChecker:r};