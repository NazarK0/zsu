"use strict";const e=require("fs"),r=require("path"),t=require("../Models/Content"),i=require("../Models/History"),n=require("../Models/SliderNames"),s=require("../Models/FileNames"),a=require("../Models/MainPhoto"),o=require("../API/getAdminid"),d=require("../API/op_categories"),l=require("../Models/User"),u=require("../API/Converter"),{ValidSession:c}=require("../API/Session/session");module.exports.getAllNews=async(e,r)=>{const i=await l.findById(o.getId(e));if(!0===await c(e.session,i.id,r)){if(!i.operation.includes(d.NEWS))return r.status(400).render("infopage",{info:"Вам обмежено доступ для данної Категорії!",url:`/admin/${i.id}/main`,url_text:"Повернутися до Головного Меню",user:i.id});try{let n;const s=await t.find().where({page_type:"news"}).select({_id:1,page_title:2,lang:3,news_type:4,date:5,keywords:6});s.reverse(),n="system_user"===i.type;let{page:a}=e.params;const d=i.settings.recordsPerPage.news,l=Math.ceil(s.length/d);(a<1||a>l)&&(a=1);const c=s.slice(d*(a-1),a*d);return r.render("main_menu_news",{status:n,user:o.getId(e),news:u.getConvert(c),pages:l,current_page:a})}catch(n){console.error(n)}}return null===await c(e.session,i.id,r)?r.redirect("/admin/login"):r.status(400).render("infopage",{info:"Даний користувач авторизований в системі, використайте інший обліковий запис!",url:"/admin/login",url_text:"Повернутися до форми авторизації",user:i.id})},module.exports.deleteNews=async(s,u)=>{const g=await l.findById(o.getId(s));if(!0===await c(s.session,g.id,u)){if(g.operation.includes(d.NEWS)){const o=await t.findByIdAndDelete(s.params.id);try{await a.findOneAndDelete({base_url:o.content_baseUrl}),await n.deleteMany({base_url:o.content_baseUrl});const e=new i({type_content:"Новини",operation:"Видалення Новини:  "+o.title,user:g.login});await e.save()}catch(p){}return e.rmdirSync(r.join(__dirname,"../..","uploads/images/"+o.content_folder),{recursive:!0}),u.redirect("../1")}return u.status(400).render("infopage",{info:"Вам обмежено доступ для данної Категорії!",url:`/admin/${g.id}/main`,url_text:"Повернутися до Головного Меню",user:g.id})}return null===await c(s.session,g.id,u)?u.redirect("/admin/login"):u.status(400).render("infopage",{info:"Даний користувач авторизований в системі, використайте інший обліковий запис!",url:"/admin/login",url_text:"Повернутися до форми авторизації",user:g.id})};