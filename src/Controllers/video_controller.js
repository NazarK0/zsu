"use strict";const e=require("../../src/Models/Video"),t=require("../../src/Models/History"),i=require("../../src/Models/User"),d=require("../API/getAdminid"),n=require("../API/userAPI/hasAccess"),o=require("../API/op_categories");module.exports.getAllVideo=async function(t,r){let a=await i.findById(d.getId(t)).lean(),c=await e.find().lean();return await n(a._id,o.VIDEO)?r.render("main_menu_video",{user:a._id,videos:c}):r.status(400).render("infopage",{info:"Вам обмежено доступ для данної Категорії!",url:"/admin/".concat(a.id,"/main"),url_text:"Повернутися до Головного Меню",user:a.id})},module.exports.getAddVideo=async function(e,t){try{let n=await i.findById(d.getId(e)).lean();return t.render("edit_video",{action_type:"add",userid:n._id})}catch(n){console.error(n)}},module.exports.postAddVideo=async function(n,o){let r=await i.findById(d.getId(n)).lean();const{title:a,description:c,link:s,date:l}=n.body;return await new e({title:a,description:c,link:s,date:l}).save(),await new t({type_content:"Відео",operation:"Додавання Відео: ".concat(a," "),user:r.login}).save(),o.redirect("/admin/".concat(r._id,"/video"))},module.exports.getEditVideo=async function(t,n){try{let o=await i.findById(d.getId(t)).lean(),r=await e.findById(t.params.id);const{_id:a,title:c,description:s,link:l,date:u}=r;return n.render("edit_video",{id:a,action_type:"edit/".concat(a),userid:o._id,title:c,description:s,link:l,date:u})}catch(o){console.error(o)}},module.exports.postEditVideo=async function(n,o){try{let r=await i.findById(d.getId(n)).lean();const{title:a,description:c,link:s,date:l}=n.body;return await e.findByIdAndUpdate(n.params.id,{title:a,description:c,link:s,date:l}),await new t({type_content:"Відео",operation:"Редагування Відео: ".concat(a," "),user:r.login}).save(),o.redirect("/admin/".concat(r._id,"/video"))}catch(r){console.error(r)}},module.exports.postRemoveVideo=async function(n,o){try{let r=await i.findById(d.getId(n)).lean(),a=await e.findByIdAndDelete(n.params.id);return await new t({type_content:"Відео",operation:"Видалення Відео: ".concat(a.title," "),user:r.login}).save(),o.redirect("/admin/".concat(r._id,"/video"))}catch(r){console.error(r)}};