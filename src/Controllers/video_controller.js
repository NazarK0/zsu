"use strict";const e=require("../../src/Models/Video"),t=require("../../src/Models/VideoCategory"),i=require("../../src/Models/History"),a=require("../../src/Models/User"),d=require("../API/getAdminid"),n=require("../API/userAPI/hasAccess"),r=require("../API/op_categories");module.exports.getAllCategorys=async(e,i)=>{let o=await a.findById(d.getId(e)).lean(),c=await t.find().lean();return await n(o._id,r.VIDEO)?i.render("main_menu_video_category",{user:o._id,videos:c}):i.status(400).render("infopage",{info:"Вам обмежено доступ для данної Категорії!",url:"/admin/".concat(o.id,"/main"),url_text:"Повернутися до Головного Меню",user:o.id})},module.exports.getAddCategory=async function(e,t){let i=await a.findById(d.getId(e)).lean();return await n(i._id,r.VIDEO)?t.render("edit_video_category",{userid:i._id,action_type:"add",parameter:"hidden "}):t.status(400).render("infopage",{info:"Вам обмежено доступ для данної Категорії!",url:"/admin/".concat(i.id,"/main"),url_text:"Повернутися до Головного Меню",user:i.id})},module.exports.getEditCategory=async function(e,i){let o=await a.findById(d.getId(e)).lean(),c=await t.findById(e.params.id).lean();const{title_ua:s,title_en:l,_id:u}=c;return await n(o._id,r.VIDEO)?i.render("edit_video_category",{selected_category_id:c._id,title_ua:s,title_en:l,userid:o._id,action_type:"edit/".concat(u)}):i.status(400).render("infopage",{info:"Вам обмежено доступ для данної Категорії!",url:"/admin/".concat(o.id,"/main"),url_text:"Повернутися до Головного Меню",user:o.id})},module.exports.postAddCategory=async function(e,o){let c=await a.findById(d.getId(e)).lean(),s={...e.body};return await n(c._id,r.VIDEO)?(await new t({title_ua:s.title_ua,title_en:s.title_en}).save(),await new i({type_content:"Відео Категорія",operation:"Додавання нової категорії: ".concat(s.title_ua,"/").concat(s.title_en),user:"".concat(c.login)}).save(),o.redirect("/admin/".concat(c._id,"/video-categorys"))):o.status(400).render("infopage",{info:"Вам обмежено доступ для данної Категорії!",url:"/admin/".concat(c.id,"/main"),url_text:"Повернутися до Головного Меню",user:c.id})},module.exports.postEditCategory=async function(e,o){let c=await a.findById(d.getId(e)).lean(),s={...e.body};if(await n(c._id,r.VIDEO)){let a=await t.findByIdAndUpdate(e.params.id,{...s});return await new i({type_content:"Відео Категорія",operation:"Редагування Відео Категорії: ".concat(a.title_ua,"/").concat(a.title_en),user:"".concat(c.login)}).save(),o.redirect("/admin/".concat(c._id,"/video-categorys"))}return o.status(400).render("infopage",{info:"Вам обмежено доступ для данної Категорії!",url:"/admin/".concat(c.id,"/main"),url_text:"Повернутися до Головного Меню",user:c.id})},module.exports.postRemoveCategory=async function(e,o){let c=await a.findById(d.getId(e)).lean();if(await n(c._id,r.VIDEO)){let a=await t.findByIdAndRemove(e.params.id);return await new i({type_content:"Відео Категорія",operation:"Видалення Відео Категорії: ".concat(a.title_ua,"/").concat(a.title_en),user:"".concat(c.login)}).save(),o.redirect("/admin/".concat(c._id,"/video-categorys"))}return o.status(400).render("infopage",{info:"Вам обмежено доступ для данної Категорії!",url:"/admin/".concat(c.id,"/main"),url_text:"Повернутися до Головного Меню",user:c.id})},module.exports.getAllVideosByCategory=async function(i,o){let c=await a.findById(d.getId(i)).lean(),s=await e.find().where({categoryId:i.params.id_category}).lean(),l=await t.findById(i.params.id_category);return await n(c._id,r.VIDEO)?o.render("main_menu_video",{category:l.title_ua,id_category:i.params.id_category,user:c._id,videos:s}):o.status(400).render("infopage",{info:"Вам обмежено доступ для данної Категорії!",url:"/admin/".concat(c.id,"/main"),url_text:"Повернутися до Головного Меню",user:c.id})},module.exports.getAddVideo=async function(e,t){try{let i=await a.findById(d.getId(e)).lean();return t.render("edit_video",{id_category:e.params.id_category,action_type:"add",userid:i._id})}catch(i){console.error(i)}},module.exports.postAddVideo=async function(t,n){let r=await a.findById(d.getId(t)).lean();const{title:o,description:c,link:s,date:l}=t.body;return await new e({title:o,description:c,link:s,date:l,categoryId:t.params.id_category}).save(),await new i({type_content:"Відео",operation:"Додавання Відео: ".concat(o," "),user:r.login}).save(),n.redirect("/admin/".concat(r._id,"/video-categorys/").concat(t.params.id_category,"/video"))},module.exports.getEditVideo=async function(t,i){try{let n=await a.findById(d.getId(t)).lean(),r=await e.findById(t.params.id);const{_id:o,title:c,description:s,link:l,date:u}=r;return i.render("edit_video",{id:o,action_type:"edit/".concat(o),userid:n._id,title:c,description:s,link:l,date:u,id_category:t.params.id_category})}catch(n){console.error(n)}},module.exports.postEditVideo=async function(t,n){try{let r=await a.findById(d.getId(t)).lean();const{title:o,description:c,link:s,date:l}=t.body;return await e.findByIdAndUpdate(t.params.id,{title:o,description:c,link:s,date:l}),await new i({type_content:"Відео",operation:"Редагування Відео: ".concat(o," "),user:r.login}).save(),n.redirect("/admin/".concat(r._id,"/video-categorys/").concat(t.params.id_category,"/video"))}catch(r){console.error(r)}},module.exports.postRemoveVideo=async function(t,n){try{let r=await a.findById(d.getId(t)).lean(),o=await e.findByIdAndDelete(t.params.id);return await new i({type_content:"Відео",operation:"Видалення Відео: ".concat(o.title," "),user:r.login}).save(),n.redirect("/admin/".concat(r._id,"/video-categorys/").concat(t.params.id_category,"/video"))}catch(r){console.error(r)}};