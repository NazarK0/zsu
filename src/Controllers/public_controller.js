"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function t(t){for(var o=1;o<arguments.length;o++){var n=null!=arguments[o]?arguments[o]:{};o%2?e(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const o=require("path"),n=require("fs"),s=require("../Models/Main_Menu"),i=require("../Models/Content"),a=require("../Models/Link"),c=require("../API/SubMenuAPI/getAllChildMain"),{getOneElementBody:l,getSideMenu:u,getNews:d,getResultForTroops:p,getSlidersPhotoPath:g}=require("../API/publicAPI/public"),w=require("got");module.exports.getMainMenu=async(e,t)=>{const r=[];try{const e=await s.find();for(let t=0;t<e.length;t++)e[t].submenu_item=await c(e[t].id),r.push(e[t]);t.set("Access-Control-Allow-Origin","*"),t.json(r)}catch(o){throw new Error(o)}},module.exports.getSideMenu=async(e,t)=>{try{const e=await u();t.set("Access-Control-Allow-Origin","*"),t.status(200).json(e)}catch(r){throw new Error(r)}},module.exports.getNewsALL=async(e,t)=>{try{const e=await d();t.set("Access-Control-Allow-Origin","*"),t.status(200).json(e)}catch(r){throw new Error(r)}},module.exports.getElementMenuBody=async(e,t)=>{t.set("Access-Control-Allow-Origin","*");try{const r=await l(e.params.id);t.status(200).json(r)}catch(r){throw new Error(r)}},module.exports.getElementSideMenu=async(e,r)=>{let o;r.set("Access-Control-Allow-Origin","*");o=t({},JSON.parse(JSON.stringify(await i.findOne().where({generated_sidemenu_link:e.params.id}))));const n=await g(e,2);o.photo=n,r.status(200).json(o)},module.exports.getNewsOne=async(e,t)=>{t.set("Access-Control-Allow-Origin","*");try{const r=await i.findById(e.params.id),o=await g(e,1);t.status(200).json({title:r.page_title,photo:o,html_body:r.html_body,createdAt:r.createdAt})}catch(r){throw new Error(r)}},module.exports.getSocialLinks=async(e,t)=>{t.set("Access-Control-Allow-Origin","*");const r=await a.find();t.status(200).json(r)},module.exports.getAllTroops=async(e,t)=>{try{t.set("Access-Control-Allow-Origin","*");const e=await p();t.status(200).json(e)}catch(r){throw new Error(r)}},module.exports.getContentPicture=async(e,t,r)=>n.readFileSync(o.join(__dirname,"../..","uploads/images",e,t,r),"base64"),module.exports.getSlider=async(e,t)=>{},module.exports.getCorpsImg=async(e,t)=>{const{type:r,name:n}=e.params;let s={filename:o.join(__dirname,"../..","uploads/images/corps",r,n)};t.sendFile(n,s,(function(e){if(e)try{next(e)}catch(t){}}))},module.exports.getContentFile=async(e,t)=>{const{content:r,name:n}=e.params;let s={root:o.join(__dirname,"../..","uploads/images",r,"files")};t.sendFile(n,s,(function(e){e&&next(e)}))};