"use strict";function e(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function t(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function o(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const n=require("path"),r=require("fs"),s=require("../Models/Message"),a=require("../Models/Main_Menu"),i=require("../Models/Content"),c=require("../Models/Link"),l=require("../API/SubMenuAPI/getAllChildMain"),{getOneElementBody:u,getSideMenu:m,getNews:d,getResultForTroops:p,getResultForCommand:g,getSlidersPhotoPath:w}=require("../API/publicAPI/public"),y=require("got"),O=require("moment"),f=O();module.exports.getMainMenu=async(e,t)=>{const o=[];try{const e=await a.find();for(let t=0;t<e.length;t++)e[t].submenu_item=await l(e[t].id),o.push(e[t]);t.set("Access-Control-Allow-Origin","*"),t.json(o)}catch(n){throw new Error(n)}},module.exports.getSideMenu=async(e,t)=>{try{const o=await m(e.params.lang);t.set("Access-Control-Allow-Origin","*"),t.status(200).json(o)}catch(o){throw new Error(o)}},module.exports.getNewsALL=async(e,t)=>{try{const o=await d(e.params.lang);t.set("Access-Control-Allow-Origin","*"),t.status(200).json(o)}catch(o){throw new Error(o)}},module.exports.getElementMenuBody=async(e,t)=>{t.set("Access-Control-Allow-Origin","*");try{const o=await u(e.params.id);t.status(200).json(o)}catch(o){throw new Error(o)}},module.exports.getElementSideMenu=async(e,o)=>{let n;o.set("Access-Control-Allow-Origin","*");n=t({},JSON.parse(JSON.stringify(await i.findOne().where({generated_sidemenu_link:e.params.id}))));const r=await w(e,2);n.photo=r,o.status(200).json(n)},module.exports.getNewsOne=async(e,t)=>{t.set("Access-Control-Allow-Origin","*");try{const o=await i.findById(e.params.id),n=await w(e,1);t.status(200).json({title:o.page_title,photo:n,html_body:o.html_body,createdAt:o.createdAt})}catch(o){throw new Error(o)}},module.exports.getSocialLinks=async(e,t)=>{t.set("Access-Control-Allow-Origin","*");const o=await c.find();t.status(200).json(o)},module.exports.getAllTroops=async(e,t)=>{try{t.set("Access-Control-Allow-Origin","*");const e=await p();t.status(200).json(e)}catch(o){throw new Error(o)}},module.exports.getAllCommand=async(e,t)=>{try{t.set("Access-Control-Allow-Origin","*");const e=await g();t.status(200).json(e)}catch(o){throw new Error(o)}},module.exports.getContentPicture=async(e,t)=>{const{content:o,type:r,img:s}=e.params,a=n.join(__dirname,"../..","uploads/images",o,r,s);return t.sendFile(a)},module.exports.getSlider=async(e,t)=>{},module.exports.getCorpsImg=async(e,t)=>{const{type:o,name:r}=e.params;let s={filename:n.join(__dirname,"../..","uploads/images/corps",o,r)};t.sendFile(r,s,(function(e){if(e)try{next(e)}catch(t){}}))},module.exports.getCommandImg=async(e,t)=>{const{type:o,name:r}=e.params;let s={filename:n.join(__dirname,"../..","uploads/images/command",o,r)};t.sendFile(r,s,(function(e){if(e)try{next(e)}catch(t){}}))},module.exports.getContentFile=async(e,t)=>{const{content:o,name:r}=e.params;let s={root:n.join(__dirname,"../..","uploads/images",o,"files")};t.sendFile(r,s,(function(e){e&&next(e)}))},module.exports.getRss=async(e,t)=>t.status(200).sendFile(n.join(__dirname,"../..","public","rss.xml")),module.exports.SaveMessage=async(e,t)=>{const{email:o,text:n}=e.body;return await new s({email:o,text:n,date:f.format("DD-MM-YY-HH-MM")}).save(),t.status(200).json({Message:"Good"})};