"use strict";function e(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function t(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const r=require("path"),n=require("fs"),s=require("../Models/Message"),a=require("../Models/Main_Menu"),i=require("../Models/Content"),l=require("../Models/Link"),c=require("../API/SubMenuAPI/getAllChildMain"),{getOneElementBody:u,getSideMenu:d,getNews:m,getResultForTroops:p,getResultForCommand:g,getSlidersPhotoPath:w}=require("../API/publicAPI/public"),y=require("got"),O=require("moment"),f=O();module.exports.getMainMenu=async(e,t)=>{const o=[];try{const r=await a.find({lang:e.params.lang});for(let e=0;e<r.length;e++)r[e].submenu_item=await c(r[e].id),o.push(r[e]);t.set("Access-Control-Allow-Origin","*"),t.json(o)}catch(r){throw new Error(r)}},module.exports.getSideMenu=async(e,t)=>{try{const o=await d(e.params.lang);t.set("Access-Control-Allow-Origin","*"),t.status(200).json(o)}catch(o){throw new Error(o)}},module.exports.getNewsALL=async(e,t)=>{try{const o=await m(e.params.lang);t.set("Access-Control-Allow-Origin","*"),t.status(200).json(o)}catch(o){throw new Error(o)}},module.exports.getElementMenuBody=async(e,t)=>{t.set("Access-Control-Allow-Origin","*");try{const o=await u(e.params.id);t.status(200).json(o)}catch(o){throw new Error(o)}},module.exports.getElementSideMenu=async(e,o)=>{let r;o.set("Access-Control-Allow-Origin","*");r=t({},JSON.parse(JSON.stringify(await i.findOne().where({generated_sidemenu_link:e.params.id}))));const n=await w(e,2);r.photo=n,o.status(200).json(r)},module.exports.getNewsOne=async(e,t)=>{t.set("Access-Control-Allow-Origin","*");try{const o=await i.findById(e.params.id),r=await w(e,1);t.status(200).json({title:o.page_title,photo:r,html_body:o.html_body,createdAt:o.createdAt})}catch(o){throw new Error(o)}},module.exports.getSocialLinks=async(e,t)=>{t.set("Access-Control-Allow-Origin","*");const o=await l.find();t.status(200).json(o)},module.exports.getAllTroops=async(e,t)=>{try{t.set("Access-Control-Allow-Origin","*");const e=await p();t.status(200).json(e)}catch(o){throw new Error(o)}},module.exports.getAllCommand=async(e,t)=>{try{t.set("Access-Control-Allow-Origin","*");const e=await g();t.status(200).json(e)}catch(o){throw new Error(o)}},module.exports.getContentPicture=async(e,t,o)=>n.readFileSync(r.join(__dirname,"../..","uploads/images",e,t,o),"base64"),module.exports.getSlider=async(e,t)=>{},module.exports.getCorpsImg=async(e,t)=>{const{type:o,name:n}=e.params;let s={filename:r.join(__dirname,"../..","uploads/images/corps",o,n)};t.sendFile(n,s,(function(e){if(e)try{next(e)}catch(t){}}))},module.exports.getCommandImg=async(e,t)=>{const{type:o,name:n}=e.params;let s={filename:r.join(__dirname,"../..","uploads/images/command",o,n)};t.sendFile(n,s,(function(e){if(e)try{next(e)}catch(t){}}))},module.exports.getContentFile=async(e,t)=>{const{content:o,name:n}=e.params;let s={root:r.join(__dirname,"../..","uploads/images",o,"files")};t.sendFile(n,s,(function(e){e&&next(e)}))},module.exports.getRss=async(e,t)=>t.status(200).sendFile(r.join(__dirname,"../..","public","rss.xml")),module.exports.SaveMessage=async(e,t)=>{const{email:o,text:r}=e.body;return await new s({email:o,text:r,date:f.format("DD-MM-YY-HH-MM")}).save(),t.status(200).json({Message:"Good"})};
