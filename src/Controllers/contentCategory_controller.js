"use strict";const e=require("../Models/Category"),t=require("../Models/User"),r=require("../Models/History"),i=require("../API/getAdminid"),{ValidSession:d}=require("../API/Session/session"),a=require("../API/userAPI/hasAccess"),n=require("../API/op_categories"),o=require("../API/userAPI/enabledIds"),{getConvert:s}=require("../API/Converter");module.exports.getCategoryList=async(r,d)=>{const a=await t.findById(i.getId(r));try{const{contentType:t}=r.params,i=await e.find({contentType:t}).lean(),n=Array.from(i).map(e=>{const t={...e};return e.img?t.img=`/image/${e.img}?height=90&width=90`:t.img="",t});return d.render("main_menu_category",{user:a.id,categories:n,contentType:t})}catch(n){console.error(n)}},module.exports.getAddCategory=async(e,r)=>{const d=await t.findById(i.getId(e)),{contentType:a}=e.params,n={mode:"add",userid:d.id,contentType:a};return r.render("edit_category",n)},module.exports.postAddCategory=async(r,d)=>{const a=await t.findById(i.getId(r)),{title_ua:n,title_en:o,categoryId:s}=r.body,{contentType:c}=r.params,y={title_ua:n,title_en:o,user_id:a.id,contentType:c};return s?await e.findByIdAndUpdate(s,y):await new e(y).save(),d.redirect("./1")},module.exports.getEditCategory=async(r,d)=>{const a=await t.findById(i.getId(r)),{contentType:n,id:o}=r.params,{title_ua:s,title_en:c,img:y}=await e.findById(o).lean(),g={mode:"edit",title_ua:s,title_en:c,userid:a.id,categoryId:o,contentType:n};return g.imgSrc=y?`/image/${y}?height=200&width=200`:"",d.render("edit_category",g)},module.exports.postEditCategory=async(r,d)=>{await t.findById(i.getId(r));const{title_ua:a,title_en:n}=r.body,{contentType:o,id:s}=r.params,c={title_ua:a,title_en:n};return await e.findByIdAndUpdate(s,c),d.redirect("../1")},module.exports.postDeleteCategory=async(r,d)=>{try{let a=await t.findById(i.getId(r));return await e.findByIdAndRemove(r.params.id),d.redirect(`/admin/${a._id}/news/category/1`)}catch(a){console.log(a)}};