"use strict";const e=require("../Models/MediaCategory"),t=require("../Models/User"),a=require("../Models/History"),r=require("../API/op_categories"),i=require("../API/getAdminid"),o=require("../API/userAPI/hasAccess");module.exports.getAllCategorys=async function(a,n){try{const d=await t.findById(i.getId(a));if(await o(d.id,r.GALERY)){const t=await e.find({status:"complete"}).select({title_ua:1,title_en:2}).lean();return n.render("main_menu_media",{user:d._id,medias:t})}return n.status(400).render("infopage",{info:"Вам обмежено доступ для данної Категорії!",url:`/admin/${d.id}/main`,url_text:"Повернутися до Головного Меню",user:d.id})}catch(d){console.error(d)}},module.exports.getAddCategory=async function(e,t){try{const a=await i.getId(e);return t.render("edit_media_category",{userid:a,mode:"add"})}catch(a){console.error(a)}},module.exports.getEditCategory=async function(t,a){try{const r=await i.getId(t),o=await e.findById(t.params.id).lean();return a.render("edit_media_category",{title_ua:o.title_ua,title_en:o.title_en,id:o._id,userid:r,mode:"edit",galeryCurrent:o.photos})}catch(r){console.error(r)}},module.exports.postAddCategory=async function(r,o){try{const n=await t.findById(i.getId(r)),{title_ua:d,title_en:s,categoryId:c}=r.body;return c?await e.findByIdAndUpdate(c,{title_ua:d,title_en:s,status:"complete"}):(await new e({title_ua:d,title_en:s,status:"complete"}).save(),await new a({type_content:"Фото",operation:`Додавання Категорії: ${d} `,user:n.login}).save()),o.redirect(`/admin/${n._id}/media-category`)}catch(n){console.error(n)}},module.exports.postEditCategory=async function(r,o){try{const n=await t.findById(i.getId(r)),{title_ua:d,title_en:s}=r.body;return await e.findByIdAndUpdate(r.params.id,{title_ua:d,title_en:s}),await new a({type_content:"Фото",operation:`Редагування Категорії: ${d} `,user:n.login}).save(),o.redirect(`/admin/${n._id}/media-category`)}catch(n){console.error(n)}},module.exports.postRemoveCategory=async function(r,o){try{const n=await t.findById(i.getId(r)).lean(),d=await e.findByIdAndDelete(r.params.id);return await new a({type_content:"Фото",operation:`Видалення Категорії: ${d.title_ua} `,user:n.login}).save(),o.redirect(`/admin/${n._id}/media-category`)}catch(n){console.error(n)}},module.exports.getAllPhotosByCategory=async function(a,r){try{const o=await t.findById(i.getId(a)),n=await e.findById(a.params.id);return r.render("media_category_photos",{user:o.id,title_ua:n.title_ua,category_id:n._id})}catch(o){console.error(o)}};