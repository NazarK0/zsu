"use strict";const e=require("../../src/Models/MediaCategory"),t=require("../../src/Models/User"),r=require("../../src/Models/History"),a=require("../API/op_categories"),i=require("../API/getAdminid"),d=require("../API/userAPI/hasAccess");module.exports.getAllCategorys=async function(r,o){try{const n=await t.findById(i.getId(r));if(await d(n.id,a.GALERY)){let t=await e.find({status:"complete"}).select({title_ua:1,title_en:2}).lean();return o.render("main_menu_media",{user:n._id,medias:t})}return o.status(400).render("infopage",{info:"Вам обмежено доступ для данної Категорії!",url:`/admin/${n.id}/main`,url_text:"Повернутися до Головного Меню",user:n.id})}catch(n){console.error(n)}},module.exports.getAddCategory=async function(e,t){try{let r=await i.getId(e);return t.render("edit_media_category",{userid:r,mode:"add"})}catch(r){console.error(r)}},module.exports.getEditCategory=async function(t,r){try{let a=await i.getId(t),d=await e.findById(t.params.id).lean();return r.render("edit_media_category",{title_ua:d.title_ua,title_en:d.title_en,id:d._id,userid:a,mode:"edit",galeryCurrent:d.photos})}catch(a){console.error(a)}},module.exports.postAddCategory=async function(a,d){try{let o=await t.findById(i.getId(a));const{title_ua:n,title_en:s,categoryId:c}=a.body;return c?await e.findByIdAndUpdate(c,{title_ua:n,title_en:s,status:"complete"}):(await new e({title_ua:n,title_en:s,status:"complete"}).save(),await new r({type_content:"Фото",operation:`Додавання Категорії: ${n} `,user:o.login}).save()),d.redirect(`/admin/${o._id}/media-category`)}catch(o){console.error(o)}},module.exports.postEditCategory=async function(a,d){try{let o=await t.findById(i.getId(a));const{title_ua:n,title_en:s}=a.body;return await e.findByIdAndUpdate(a.params.id,{title_ua:n,title_en:s}),await new r({type_content:"Фото",operation:`Редагування Категорії: ${n} `,user:o.login}).save(),d.redirect(`/admin/${o._id}/media-category`)}catch(o){console.error(o)}},module.exports.postRemoveCategory=async function(a,d){try{let o=await t.findById(i.getId(a)).lean(),n=await e.findByIdAndDelete(a.params.id);return await new r({type_content:"Фото",operation:`Видалення Категорії: ${n.title_ua} `,user:o.login}).save(),d.redirect(`/admin/${o._id}/media-category`)}catch(o){console.error(o)}},module.exports.getAllPhotosByCategory=async function(r,a){try{let d=await t.findById(i.getId(r)),o=await e.findById(r.params.id);return a.render("media_category_photos",{user:d.id,title_ua:o.title_ua,category_id:o._id})}catch(d){console.error(d)}};