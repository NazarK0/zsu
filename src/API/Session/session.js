"use strict";const s=require("uniqid"),i=require("moment"),n=require("../../Models/User"),e=i();async function t(e,t){e.id_user=t,e.id_session=s.time(),e.valid_time=i().add(2,"hours"),await n.findByIdAndUpdate(t,{session:{id_session:e.id_session,valid_time:e.valid_time,auth_status:!0}})}async function o(s,i,e){const t=JSON.parse(JSON.stringify(await n.findById(i)));if(null===t.session)return null;const o=null!==t?t.session.valid_time:null;return!0!==t.session.auth_status?null:t.session.id_session===s.id_session?!0===d(o)||(await a(t.id),null):!0!==d(o)&&(!1===d(o)?(await a(t.id),null):void 0)}function d(s){return i().isBefore(s)}async function a(s){await n.findByIdAndUpdate(s,{session:null})}module.exports={ValidSession:o,CreateSession:t,DropSessionForUser:a};