"use strict";const e=require("../../Models/User"),{hashpassword:d}=require("../../API/hashing_password"),s=require("moment"),t=s();module.exports.setValidatorForUserSession=async(i,a,o)=>{const n=await e.findById(i);console.log(n),null===n.code||n.code===d(a)?await e.findByIdAndUpdate({_id:i},{$set:{auth_status:!0,valid_time:s(t,"DD-MM-YY").add(6,"hour"),code:d(a)}}):o.json({Info:"Вхід до системи обмежено, оскільки вже авторизований користвач під даним іменем!"})},module.exports.checkValidSessionTime=async(t,i,a)=>{const o=await e.findById(t),n=s().isBefore(o.valid_time);if(!0===n){if(o.code===d(i))return!0;a.json({Info:"Вхід до системи обмежено, оскільки вже авторизований користвач під даним іменем!"})}else if(!0!==n&&d(i)===o.code)return await e.findByIdAndUpdate({_id:t},{$set:{auth_status:!1,valid_time:null,code:null}}),!1},module.exports.logout=async(s,t)=>(await e.findById(s)).code===d(t)&&(await e.findByIdAndUpdate({_id:s},{$set:{auth_status:!1,valid_time:null,code:null}}),!0);