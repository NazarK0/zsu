"use strict";const e=require("../../Models/Page"),t=require("../../Models/Menu"),i=require("../../Models/ActualContent"),n=require("../../Models/Category");module.exports=async(a,l)=>{let s={};const u=[];if("string"==typeof l?u.push(l):l instanceof Array&&u.push(...l),s.public_status={$in:u},a.length){const t=a.filter(e=>"ua"!==e&&"en"!==e);if(a.includes("ua")){const i=await e.find({language:"ua"}).select({_id:1}).lean();t.push(...i.map(e=>e._id.toString()))}if(a.includes("en")){const i=await e.find({language:"en"}).select({_id:1}).lean();t.push(...i.map(e=>e._id.toString()))}const i=Array.from(new Set(t));s={...{...s},_id:{$in:i}}}const c=await e.find(s).select({_id:1,title:2,language:3,type:4,views:5}).lean(),o=[];for(let e=0;e<c.length;e++){const a={},l=await t.findOne({pageFK:c[e]._id}).select({_id:0,title:1}).lean(),s=await i.findOne({$or:[{url_ua:"/content_page/".concat(c[e]._id)},{url_en:"/content_page/".concat(c[e]._id)}]}).select({_id:0,title_ua:1}).lean(),u=await n.findById(c[e].categoryFK).select({_id:0,title_ua:1}).lean();a.mainMenuItemTitle=l?l.title:"-",a.actualContentTitle=s?s.title_ua:"-",a.categoryTitle=u?u.title_ua:"-",a.language=c[e].language,a.views=c[e].views,a.title=c[e].title,a._id=c[e]._id,o.push(a)}return o.reverse(),o};