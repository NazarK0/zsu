"use strict";const e=require("fs"),t=require("path"),i=require("moment"),{Feed:s}=require("feed"),r=require("../Models/News"),{host:o,rssMaxFeeds:a}=require("../../settings.json");module.exports.updateRss=async()=>{const n=t.join(__dirname,"../..","public","rss.xml"),l=await r.find({public_status:"active"}).select({title:1,description:2,publishDate:3,html_body:4,slider:5}).limit("number"==typeof a?a:50).lean();l.sort((e,t)=>t.publishDate-e.publishDate);const d=new s({title:"Офіційний портал ЗСУ",description:"Збройні сили України",link:"https://"+o,language:"uk-ua",image:"https://zsu.gov.ua/image/mo.png"});d.addCategory("Новини"),l.forEach(e=>{const t={title:e.title,description:e.description,link:`https://${o}/content_page/${e._id}`,date:i(e.publishDate).toDate(),content:e.html_body,id:e._id};e.slider.length&&(t.image=`https://zsu.gov.ua/image/${e.slider[0]}?height=180&width=180`),d.addItem(t)});const u=d.rss2();e.writeFile(n,u,e=>{e&&console.error("write rss file error",e)})};