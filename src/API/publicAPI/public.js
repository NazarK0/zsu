"use strict";const e=require("moment"),t=require("../../Models/Corps"),a=require("../../Models/Command"),n=require("../../Models/Category"),s=require("../../Models/News"),o=require("../../Models/ActualContent");module.exports.getNews=async(e,t)=>({news:(await s.find().where({public_status:"active",language:e}).select({id:1,publishDate:2,mainPhoto:3,categoryFK:4,description:5,title:6,type:7}).lean()).sort((e,t)=>new Date(t.publishDate)-new Date(e.publishDate)).slice(0,30),category:await n.find().where({contentType:"news"}).lean()}),module.exports.getFiltersNews=async t=>{let a=[],o=[];const r=await s.find().where({language:t.lang,public_status:"active"}).select({_id:1,publishDate:2,mainPhoto:3,categoryFK:4,description:5,title:6,type:7}).lean();r.sort((e,t)=>new Date(t.publishDate)-new Date(e.publishDate));const i=await n.find().where({contentType:"news"}).lean();return""===t.date&""===t.category?(a=[...i],{news:r,category:a}):(""!==t.date?(o=r.filter(a=>e(a.publishDate).format("DD/MM/YY")===t.date),""!==t.category&&(o=o.filter(e=>e.categoryFK===t.category))):""!==t.category&&(o=r.filter(e=>e.categoryFK===t.category)),a=[...i],{news:o,category:a})},module.exports.getResultForTroops=async()=>await t.find().lean(),module.exports.getResultForCommand=async()=>await a.find().lean(),module.exports.getActual=async e=>{let t;switch(e){case"en":t=await o.find().where({published:!0,$or:[{hasEnContent:!0},{hasDirectLinkEn:!0}]});break;case"ua":t=await o.find().where({published:!0,$or:[{hasUaContent:!0},{hasDirectLinkUa:!0}]})}for(let a=0;a<t.length;a++){if(1==t[a].hasUaContent){const e=t[a].url_ua.slice(14,t[a].url_ua.length);console.log(e),t[a].url_ua=e}if(1==t[a].hasEnContent){console.log("in en");const e=t[a].url_en.slice(14,t[a].url_en.length);t[a].url_en=e}}return t};