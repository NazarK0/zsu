"use strict";const n=require("lodash"),e=require("../../Models/ChildSub"),t=require("../../Models/Content");module.exports.updateChildSub=async n=>{const{id:d}=n.params,{title:i,lang:a,content_id:l}=n.body;try{if("null"!==l&&"unlink"!==l&&l)await t.updateMany({generated_menu_link:d},{generated_menu_link:null}),await t.findByIdAndUpdate(l,{generated_menu_link:d}),await e.findByIdAndUpdate(d,{title:i,lang:a,content_id:l});else if("unlink"===l){const n=await e.findById(d);"null"!==n.content_id&&n.content_id&&await t.findByIdAndUpdate(n.content_id,{generated_menu_link:null}),await e.findByIdAndUpdate(d,{title:i,lang:a,content_id:null})}else await e.findByIdAndUpdate(d,{title:i,lang:a})}catch(o){console.log(o)}},module.exports.deleteChildSub=async d=>{const{id:i}=d.params;try{const d=await e.findByIdAndRemove(i);"null"!==d.content_id&&d.content_id&&await t.findByIdAndUpdate(d.content_id,{generated_menu_link:null});const a=await e.find({parent_sub:d.id}).select({_id:1});let l=[];for(let n=0;n<a.length;n++)l.push(await e.find({parent_sub:a[n].id}).select({_id:1}));l=n.flattenDeep(l);const o=n.concat(a,l);for(let n=0;n<o.length;n++)await e.findByIdAndDelete(o[n].id),await t.findOneAndUpdate({generated_menu_link:o[n]},{generated_menu_link:null})}catch(a){console.log(a)}};